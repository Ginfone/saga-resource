[![npm][npm-image]][npm-url] [![Build Status][travis-image]][travis-url] [![codecov][codecov-image]][codecov-url]

saga-resource
=============

**Write your store in one place, without boilerplates**

Features:
------------
- Easy to implement on your current redux + redux-saga archetecturee 

## The initial setup

### Make your resource
```typescript
// ./store/counter.ts
import {delay, put} from 'redux-saga/effects';
import {makeResource} from 'saga-resource';

interface CounterState {
	count: number;
}

interface CounterReducers {
	inc: (num?:number) => CounterState;
}

interface CounterEffects {
	asyncInc: (num?:number) => any;
}

const counter = makeResource<CounterState, CounterReducers, CounterEffects>({
	name: 'counter',
	state: {
		count: 0,
	},
	reducers: {
		inc: (num=1, {state}) => {
			return {...state, ...{count: state.count + num}};
		},
	},
	effects: {
		*asyncInc(num=1): any {
		    yield delay(500);
			yield put(counter.actions.inc(num));
		},
	},
});

export default counter;
```

### Make your store
```typescript 
// ./store/index.ts
import {combineResources} from 'saga-resource'
import counter from './counter'

const combinedResources = combineResources({counter})

const rootReducer = combinedResources.combineReducers()
const rootSaga = combinedResources.getSaga()

export type AppState = ReturnType<typeof rootReducer>

const sagaMiddleware = createSagaMiddleware();

const store = createStore(rootReducer, bindMiddleware(sagaMiddleware))
sagaMiddleware.run(rootSaga)

export default store
```

You are all setup, let's dispatch resource actions from your component.
```typescript
// ./YourComponent.jsx
import counter from 'store/counter';

// ...
const mapDispatchToProps = (dispatch) => {
    return {
        add5: dispatch(counter.actions.inc(5))
        asyncAdd: dispatch(counter.actions.asyncInc())
    }
}
// ...
```
**actions will be generated by reducers and effects you defined.**

yield saga-resource effect from your saga file.
```typescript
// ./YourSagaFile.js
import counter from 'store/counter';
// ...
function* asyncAdd5(){
    try {
        yield counter.effects.asyncInc(5)
    }
}
// ...
```

## Built-in reducers
There are 3 built in reducers, `set, update, clear`
`set` will overwrite your state `e.g. dispatch(resource.actions.set(newState))`
`update` will set the key with the payload, the key can be a path, `e.g. update your key 'a.b.c with data' dispatch(resource.actions.update('a.b.c', data))`
`clear` clear will reset your state to it's initial state. `e.g. dispatch(resource.actions.clear())`

## Built-in effects
There are 4 built-in effects, `createRequest, updateRequest, fetchRequest, deleteRequest`, these four effects will send request corresponds to `post, patch, get, delete`, with exception that `fetchRequest` will set your state based on data the request returns.

You can call these method only if you have `path` setup in your resource definition.


### API

[npm-image]: https://img.shields.io/npm/v/saga-resource.svg?style=flat
[npm-url]: https://www.npmjs.com/package/saga-resource
[travis-image]: https://travis-ci.com/MichaelDuo/saga-resource.svg?branch=master
[travis-url]: https://travis-ci.com/MichaelDuo/saga-resource
[codecov-image]: https://codecov.io/gh/michaelduo/saga-resource/branch/master/graph/badge.svg
[codecov-url]: https://codecov.io/gh/MichaelDuo/saga-resource
